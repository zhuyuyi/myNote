---
# ä¸»é¢˜åˆ—è¡¨ï¼šjuejin, github, smartblue, cyanosis, channing-cyan, fancy, hydrogen, condensed-night-purple, greenwillow
# è´¡çŒ®ä¸»é¢˜ï¼šhttps://github.com/xitu/juejin-markdown-themes
theme: juejin
highlight:
---
## elasticsearchå°ç™½å…¥é—¨

### ä»‹ç»
ç¬¬ä¸€æ¬¡åœ¨æ˜é‡‘å‘è¡¨æ–‡ç« ï¼Œæœ‰äº›ä¸è¶³ä¹‹å¤„ï¼Œæ±‚å‹¿å–·ï¼æ±‚å‹¿å–·ï¼æ±‚å‹¿å–·ï¼
èº«ä¸ºä¸€ä¸ªå‰ç«¯ï¼Œå±…ç„¶æesåŸå› åœ¨äºæˆ‘ä»¬å…¬å¸å†…éƒ¨çš„wikiæ–‡æ¡£å…¨æ ˆé¡¹ç›®çš„ä½¿ç”¨ï¼Œç”±äºæ—¥ç›Šå¢å¤šçš„æ–‡ç« å’Œæƒ³è¦å…¨æ–‡æ£€ç´¢çš„éœ€æ±‚ï¼Œæ‰å¼•å…¥äº†esã€‚
[è½¦300å·¥å…·å¹³å°ï¼Œé¡¹ç›®ç›®å‰è¿˜æ²¡å…¬å¼€å‡ºæ¥ï¼Œé¢„è®¡2021å¹´å…¬å¼€ã€‚](https://fe.che300.com/easé¡¹ç›®)

### èµ·æºLucene
ä¸€ä¸ªå« Doug Cutting çš„ç¾å›½å·¥ç¨‹å¸ˆè¿·ä¸Šäº†æœç´¢å¼•æ“ï¼Œä»–åšäº†ä¸€ä¸ªç”¨äºæ–‡æœ¬æœç´¢çš„å‡½æ•°åº“ï¼ˆè½¯ä»¶åŠŸèƒ½ç»„ä»¶ï¼‰ï¼Œå‘½åä¸ºLuceneã€‚Luceneæ˜¯JAVAå†™çš„ï¼Œç›®æ ‡æ˜¯ä¸ºå„ç§ä¸­å°å‹åº”ç”¨è½¯ä»¶åŠ å…¥å…¨æ–‡æ£€ç´¢åŠŸèƒ½ã€‚å› ä¸ºå¥½ç”¨ä¸”å¼€æºï¼Œéå¸¸å—ç¨‹åºå‘˜æ¬¢è¿ã€‚
æ—©æœŸæ˜¯ç”±è¿™ä¸ªäººè‡ªå·±ç»´æŠ¤ï¼ŒåæœŸåšå¤§åï¼Œ2001å¹´åº•ï¼Œæˆä¸ºApacheè½¯ä»¶åŸºé‡‘ä¼šjakartaé¡¹ç›®çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚

Lucene æ˜¯ä¸€ä¸ªä¿¡æ¯æ£€ç´¢å·¥å…·åŒ…ï¼ŒjaråŒ…ï¼Œä¸åŒ…å«æœç´¢å¼•æ“ç³»ç»Ÿï¼
åŒ…å«äº†ï¼šç´¢å¼•ç»“æ„ã€è¯»å†™ç´¢å¼•çš„å·¥å…·ã€æ’åºã€æœç´¢è§„åˆ™...å·¥å…·ç±»ï¼

#### Lucene å’Œ Elasticsearch 
elasticSearch æ˜¯åŸºäºLucene åšäº†ä¸€äº›å°è£…å’Œå¢å¼ºã€‚esæ˜¯ä¸€ä¸ªå¼€æºçš„ã€é«˜æ‹“å±•çš„ã€åˆ†å¸ƒå¼ã€å…¨æ–‡æ£€ç´¢å¼•æ“ã€‚è¯ç”Ÿäº21ä¸–çºªå¤§æ•°æ®æ—¶ä»£ã€‚ï¼ˆRestful Apiï¼‰ã€‚2016å¹´è¶…è¿‡solrï¼Œæˆä¸ºæ’åç¬¬ä¸€ä¸ªçš„æœç´¢å¼•æ“ç±»åº”ç”¨ã€‚

#### Elasticsearchå†å²
å¤šå¹´å‰ï¼Œä¸€ä¸ªå«åšShay Banonåˆšç»“å©šä¸ä¹…çš„å¤±ä¸šå¼€å‘è€…ï¼Œç”±äºå¦»å­è¦å»ä¼¦æ•¦å­¦ä¹ å¨å¸ˆï¼Œä»–å°±è·Ÿè€å©†ä¸€èµ·å»äº†ï¼Œåœ¨ä»–æ‰¾å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†ç»™å¦»å­æ„å»ºä¸€ä¸ªé£Ÿè°±æœç´¢å¼•æ“ï¼Œä»–å°±å¼€å§‹ä½¿ç”¨Luceneå·¥å…·åŒ…å¼€å‘ã€‚ç”±äºç›´æ¥ä½¿ç”¨åŸç”Ÿå·¥å…·åŒ…éå¸¸éº»çƒ¦ï¼Œäºæ˜¯ä»–å°±å¼€å§‹æŠ½è±¡åŒ–Luceneä»£ç å†™è‡ªå·±çš„å°è£…ï¼Œåæ¥ä»–åœ¨æ‰¾åˆ°å·¥ä½œååˆé‡å†™äº† è‡ªå·±çš„å°è£…ï¼Œå¹¶å‘½åä¸º`elasticsearch`ã€‚
å†åæ¥ï¼Œ2010å¹´2æœˆï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆeså‘å¸ƒï¼Œesåœ¨çŸ­æ—¶é—´å†…ç¬é—´æˆä¸ºå½“æ—¶ github ä¸Šæœ€å—æ¬¢è¿çš„é¡¹ç›®ä¹‹ä¸€ï¼Œä¸€å®¶ä¸»è¥esçš„å…¬å¸å°±æ­¤æˆç«‹ï¼Œä»–ä»¬ä¸€è¾¹å¼€å‘æ–°åŠŸèƒ½ï¼Œä¸€è¾¹æä¾›å•†ç”¨ï¼Œå¹¶`æ°¸è¿œå¼€æº`,
é—æ†¾çš„æ˜¯ï¼ŒShayçš„å¦»å­ä¾ç„¶åœ¨ç­‰å¾…é£Ÿè°±æœç´¢....

### ä»€ä¹ˆæ˜¯æœç´¢ï¼Ÿ
1ï¼‰ç™¾åº¦ï¼Œè°·æ­Œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥ä¸€äº›å…³é”®å­—å»æœç´¢æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ã€‚
2ï¼‰äº’è”ç½‘çš„æœç´¢ï¼šç”µå•†ç½‘ç«™ã€‚æ‹›è˜ç½‘ç«™ã€‚æ–°é—»ç½‘ç«™ã€‚å„ç§APPï¼ˆç™¾åº¦å¤–å–ï¼Œç¾å›¢ç­‰ç­‰ï¼‰
3ï¼‰windowsç³»ç»Ÿçš„æœç´¢ç­‰ç­‰

æ€»ç»“ï¼šæœç´¢æ— å¤„ä¸åœ¨ã€‚é€šè¿‡ä¸€äº›å…³é”®å­—ï¼Œç»™æˆ‘ä»¬æŸ¥è¯¢å‡ºæ¥è·Ÿè¿™äº›å…³é”®å­—ç›¸å…³çš„ä¿¡æ¯

### ä»€ä¹ˆæ˜¯å…¨æ–‡æ£€ç´¢ï¼Ÿ
å…¨æ–‡æ£€ç´¢æ˜¯æŒ‡è®¡ç®—æœºç´¢å¼•ç¨‹åºé€šè¿‡æ‰«ææ–‡ç« ä¸­çš„æ¯ä¸€ä¸ªè¯ï¼Œå¯¹æ¯ä¸€ä¸ªè¯å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼ŒæŒ‡æ˜è¯¥è¯åœ¨æ–‡ç« ä¸­å‡ºç°çš„æ¬¡æ•°å’Œä½ç½®ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œæ£€ç´¢ç¨‹åºå°±æ ¹æ®äº‹å…ˆå»ºç«‹çš„`ç´¢å¼•`è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶å°†æŸ¥æ‰¾çš„ç»“æœåé¦ˆç»™ç”¨æˆ·çš„æ£€ç´¢æ–¹å¼ã€‚è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºé€šè¿‡å­—å…¸ä¸­çš„æ£€ç´¢å­—è¡¨æŸ¥å­—çš„è¿‡ç¨‹ã€‚

### ä»€ä¹ˆæ˜¯ Elasticsearchï¼Ÿ
> ä½¿ç”¨ java è¯­è¨€å¼€å‘çš„ä¸€å¥—å¼€æºçš„å…¨æ–‡æœç´¢å¼•æ“
> ç”¨äºæœç´¢ã€æ—¥å¿—ç®¡ç†ã€å®‰å…¨åˆ†æã€æŒ‡æ ‡åˆ†æã€ä¸šåŠ¡åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ç­‰å¤šä¸ªé¢†åŸŸ
> åº•å±‚åŸºäº Lucene å¼€æºåº“å¼€å‘ï¼Œæä¾› restAPIï¼Œå¯ä»¥è¢«ä»»ä½•è¯­è¨€è°ƒç”¨
> æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¯æ°´å¹³æ‰©å±•
> æ›´æ–°è¿­ä»£å¿«ã€ç¤¾åŒºæ´»è·ƒã€æ–‡æ¡£ä¸°å¯Œ(2020å¹´9æœˆå†™çš„è¿™ç¯‡æ–‡ç« æ˜¯7.9.1ï¼Œè€Œç°åœ¨11æœˆå·²ç»7.10.xäº†)

### è‡ªè¡Œå»å®˜ç½‘ä¸‹è½½ win linux åŠå…¶ä»–ç‰ˆæœ¬å®‰è£…åŒ…
é“¾æ¥ï¼š
[elasticsearchä¸‹è½½](https://www.elastic.co/cn/downloads/elasticsearch)

[ikåˆ†è¯å™¨æ˜¯ä¸€ä¸ªgithubé¡¹ç›®ï¼Œå¯ä»¥é€‰æ‹©git clone æˆ–è€… ç›´æ¥download zip](https://github.com/medcl/elasticsearch-analysis-ik/archive/master.zip)

[kibanaä¸‹è½½](https://www.elastic.co/cn/downloads/kibana)

ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œè¿™è¾¹æ˜¯windowsç³»ç»Ÿä¸‹çš„æ•™ç¨‹ï¼Œlinuxåç»­æ¨å‡ºå¦‚ä½•å‘å¸ƒçº¿ä¸Šç­‰ç­‰ã€‚

### ç†Ÿæ‚‰esç›®å½•
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b387995e20646ef81dbee6d62776cc1~tplv-k3u1fbpfcp-zoom-1.image)

```js
bin æ˜¯å¯åŠ¨ç›®å½•
config é…ç½®æ–‡ä»¶
--- log4j2 æ—¥å¿—é…ç½®æ–‡ä»¶
--- jvm.options javaè™šæ‹Ÿæœºç›¸å…³é…ç½®
--- elasticsearch.yml elasticsearché…ç½®æ–‡ä»¶ï¼Œé»˜è®¤ 9200 ç«¯å£ï¼
lib ç›¸å…³jaråŒ…
logs æ—¥å¿—
modules ç›¸å…³æ¨¡å—
plugins æ’ä»¶å¦‚ik
```

### å¯åŠ¨
ç›´æ¥è®¿é—® `bin` ç›®å½•ä¸‹ `elasticsearch.bat`
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f187daa090e4994814379b6380ed020~tplv-k3u1fbpfcp-zoom-1.image)


### å®‰è£…å¯è§†åŒ–æ’ä»¶ elasticsearch-head
```js
git clone https://github.com/mobz/elasticsearch-head.git
```
è¿›å…¥ç›®å½•å 
```js
cnpm install 
```
è®¿é—® `localhost:9100`, å‘ç°è·¨åŸŸé—®é¢˜

å»es `config`ç›®å½• çš„ `elasticsearch.yml` æ·»åŠ è·¨åŸŸé…ç½®
```js
http.cors.enabled: true 
http.cors.allow-origin: "*" 
```
`*`ä»£è¡¨æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®ï¼Œå®é™…æ­£å¼ç¯å¢ƒä¸å¯ä»¥è¿™æ ·é…ç½®

é‡å¯ `elasticsearch` 
è¿™æ—¶å†è®¿é—®  `localhost:9100` å³å¯

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a8470011800487f94fa42fb6b3a62b5~tplv-k3u1fbpfcp-zoom-1.image)

### kibanaçš„å®‰è£…ä¸ä½¿ç”¨

#### äº†è§£ ELK
> äº†è§£ELKå·¥ç¨‹å¸ˆ   ELKæ˜¯ Elasticsearch Logstash Kibana ä¸‰å¤§å¼€æºåº“çš„ç®€ç§°ï¼Œå¸‚é¢ä¸Šä¹Ÿç§°ä¸º Elastic Stackã€‚å…¶ä¸­Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneã€åˆ†å¸ƒå¼ã€é€šè¿‡Restfulæ–¹å¼è¿›è¡Œäº¤äº’çš„è¿‘å®æ—¶æœç´¢å¹³å°æ¡†æ¶ã€‚åƒç™¾åº¦ã€è°·æ­Œè¿™ç§å¤§æ•°æ®å…¨æ–‡æœç´¢å¼•æ“çš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨esè¿™ä½œä¸ºåº•å±‚æ”¯æŒæ¡†æ¶ï¼Œå¯è§esæä¾›çš„æœç´¢èƒ½åŠ›ç¡®å®å¼ºå¤§ï¼ŒLogstash æ˜¯ä¸­å¤®æ•°æ®æµå¼•æ“ï¼Œç”¨äºä»ä¸åŒç›®æ ‡ï¼ˆæ–‡ä»¶/æ•°æ®å­˜å‚¨/MQï¼‰æ”¶é›†çš„ä¸åŒæ ¼å¼æ•°æ®ï¼Œç»è¿‡è¿‡æ»¤ååªæ”¯æŒè¾“å‡ºåˆ°ä¸åŒç›®çš„åœ°ï¼ˆæ–‡ä»¶/MQ/redis/esç­‰ï¼‰ã€‚Kibanaæ˜¯ä¸€ä¸ªeså¯è§†åŒ–å·¥å…·ï¼Œæä¾›äº†å®æ—¶åˆ†æçš„èƒ½åŠ›ã€‚

æ”¶é›†æ¸…æ´—æ•°æ® ---> æœç´¢ï¼Œå­˜å‚¨ --->Kibana
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7aa912e4e2d4d798f34716516ba321a~tplv-k3u1fbpfcp-zoom-1.image)

`è¦ä¿è¯Kibanaç‰ˆæœ¬å’Œesä¿æŒä¸€è‡´`

[kibanaçš„windowsä¸‹è½½åœ°å€ï¼Œç‚¹å‡»å³å¯ä¸‹è½½](https://artifacts.elastic.co/downloads/kibana/kibana-7.9.1-windows-x86_64.zip)

#### å¯åŠ¨
`kibana-7.9.1-windows-x86_64\bin` ç›®å½•ä¸‹çš„ `kibana.bat`

```tablePic
|  ![](https://fe.che300.com/easymock/upload/2020/09/22/64a8d5d4abfb5c69f375dc282bdd75fd.png)
|_
```
è®¿é—® 5601ç«¯å£å³å¯è®¿é—®

ps:å¼€å‘å·¥å…·ï¼ï¼ˆpostmanç­‰ç­‰å…¶ä»–çš„ï¼‰

#### ä¿®æ”¹æ±‰åŒ–
å»é…ç½®æ–‡ä»¶`D:\tools\kibana-7.9.1-windows-x86_64\config\kibana.yml`ä¸­ä¿®æ”¹
```
i18n.locale: "zh-CN"
```

### esæ ¸å¿ƒæ¦‚å¿µ
esæ˜¯é¢å‘æ–‡æ¡£çš„éå…³ç³»æ•°æ®åº“

| å…³ç³»å‹æ•°æ®åº“ | es |
| --- | --- |
| æ•°æ®åº“ | ç´¢å¼• |
| è¡¨ | typesï¼ˆæ…¢æ…¢è¢«å¼ƒç”¨äº†ï¼Œ7.x.xç‰ˆæœ¬ä½¿ç”¨ç»Ÿä¸€çš„_doc,å¹¶åœ¨æŸ¥è¯¢å‘½ä»¤ä¸­å¯ä»¥çœç•¥ï¼‰ |
| è¡Œ | documentsï¼ˆæ–‡æ¡£ï¼‰ |
| å­—æ®µ | fields |

#### æ–‡æ¡£
esæ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œ
* æ„å‘³ç€ç´¢å¼•å’Œæœç´¢æ•°æ®çš„æœ€å°å•ä½æ˜¯æ–‡æ¡£ï¼Œç±»ä¼¼å…³ç³»æ•°æ®åº“ä¸­æŸå¼ è¡¨ä¸­çš„ä¸€è¡Œè®°å½•ï¼ˆå¥½ç†è§£ï¼‰
* æ–‡æ¡£ä¼šè¢«åºåˆ—åŒ–æˆ JSON æ ¼å¼ï¼ŒJSON å¯¹è±¡ç”±å­—æ®µç»„æˆï¼ˆä»¥jsonæ ¼å¼å­˜å‚¨ï¼‰
* æ¯ä¸ªå­—æ®µéƒ½æœ‰å¯¹åº”çš„å­—æ®µç±»å‹ï¼Œç±»å‹å¯ä»¥è‡ªå·±æŒ‡å®šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ElasticSearch è‡ªåŠ¨æ¨ç®—ï¼ˆæ™ºèƒ½åŒ–ï¼‰
* JSON æ–‡æ¡£æ”¯æŒæ•°ç»„å’ŒåµŒå¥—ï¼ˆè‡ªç”±åº¦å¾ˆé«˜ï¼‰
* æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ€§ IDï¼Œå¯ä»¥è‡ªå·±æŒ‡å®šï¼Œä¹Ÿå¯ä»¥ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼ˆæ™ºèƒ½åŒ–ï¼‰

å°½ç®¡æˆ‘ä»¬å¯ä»¥éšæ„æ–°å¢å¿½ç•¥æŸä¸ªå­—æ®µï¼Œä½†æ˜¯æ¯ä¸ªå­—æ®µçš„ç±»å‹éå¸¸é‡è¦ï¼Œæ¯”å¦‚ä¸€ä¸ªå¹´é¾„ç±»å‹å­—æ®µï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯æ•´æ•°ï¼Œå› ä¸ºesä¸­ä¼šä¿å­˜å­—æ®µå’Œç±»å‹ä¹‹é—´çš„æ˜ å°„ä»¥åŠå…¶ä»–çš„è®¾ç½®ï¼Œè¿™ç§æ˜ å°„å…·ä½“åˆ°æ¯ä¸ªæ˜ å°„çš„æ¯ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨esä¸­ï¼Œç±»å‹æœ‰æ—¶å€™ä¹Ÿç§°ä¸ºæ˜ å°„ç±»å‹ã€‚

ä¸€ä¸ªæ–‡æ¡£ä¸»è¦å…ƒç´ å¤§è‡´åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
```
1. _index: æ–‡æ¡£æ‰€å±çš„ç´¢å¼•å
2. _type: æ–‡æ¡£æ‰€å±çš„ç±»å‹å(åºŸå¼ƒå“)
3. _id: æ–‡æ¡£çš„å”¯ä¸€ID
4. _source: æ–‡æ¡£å­˜å‚¨çš„ Json æ•°æ®
5. _versionï¼šæ–‡æ¡£çš„ç‰ˆæœ¬ä¿¡æ¯
6. _score: ç›¸å…³æ€§æ‰“åˆ†
```

#### ~~ç±»å‹~~
~~ç±»å‹æ˜¯æ–‡æ¡£çš„é€»è¾‘å®¹å™¨ï¼Œå°±åƒå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼Œè¡¨æ ¼æ˜¯è¡Œçš„å®¹å™¨ã€‚~~

#### ç´¢å¼•
æœ€ç›´æ¥çš„ç†è§£å°±æ˜¯æ•°æ®åº“ï¼
* æ¯ä¸ªç´¢å¼•éƒ½æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ–‡æ¡£é›†åˆã€‚
* æ¯ä¸ªç´¢å¼•æœ‰è‡ªå·±çš„ Mapping ç”¨äºå®šä¹‰æ–‡æ¡£çš„å­—æ®µåå’Œå­—æ®µç±»å‹
* æ¯ä¸ªç´¢å¼•æœ‰è‡ªå·±çš„ Settings ç”¨äºå®šä¹‰ä¸åŒçš„æ•°æ®åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•ä½¿ç”¨åˆ†ç‰‡çš„æƒ…å†µï¼ˆæˆ‘æ²¡ç”¨è¿‡ğŸ‘»ğŸ‘»ğŸ‘»ï¼‰

##### èŠ‚ç‚¹å’Œé›†ç¾¤å¦‚ä½•å·¥ä½œ
ä¸€ä¸ªé›†ç¾¤è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªesè¿›ç¨‹ï¼ŒèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼ˆé»˜è®¤çš„ï¼‰ï¼Œå¦‚æœä½ åˆ›å»ºç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•å°†ä¼šæœ‰5ä¸ªåˆ†ç‰‡ï¼ˆprimary shardï¼Œåˆç§°ä¸»åˆ†ç‰‡ï¼‰æ„æˆçš„ï¼Œæ¯ä¸€ä¸ªä¸»åˆ†ç‰‡ä¼šæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼ˆreplica shardï¼Œåˆç§°å¤åˆ¶åˆ†ç‰‡ï¼‰
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a179722b70a949ac9c7ed7a0b8d5d97a~tplv-k3u1fbpfcp-zoom-1.image)
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0da15af9eb0f47fd9a8da746abfc44d8~tplv-k3u1fbpfcp-zoom-1.image)

å› ä¸ºä¸æ˜¯ä¸“èŒåšè¿™ä¸ªçš„ï¼Œæ‰€ä»¥è¿™é‡Œå…³äºè¿™äº›ä¸œè¥¿å°±ä¸€å¸¦è€Œè¿‡äº†ã€‚ã€‚ã€‚ï¼Œå°ç™½å…¥é—¨ä¸éœ€è¦äº†è§£å¤ªå¤šåº•å±‚å§

##### å€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆ
esä½¿ç”¨çš„æ˜¯ä¸€ç§ç§°ä¸ºå€’æ’ç´¢å¼•çš„ç»“æ„ï¼Œé‡‡ç”¨Luceneå€’æ’ç´¢å¼•ä½œä¸ºåº•å±‚ï¼Œè¿™ç§ç»“æ„é€‚ç”¨äºå¿«é€Ÿçš„å…¨æ–‡ç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•ç”±æ–‡æ¡£ä¸­æ‰€æœ‰çš„ä¸é‡å¤çš„åˆ—è¡¨æ„æˆï¼Œå¯¹äºæ¯ä¸€ä¸ªè¯ï¼Œéƒ½æœ‰ä¸€ä¸ªåŒ…å«å®ƒçš„æ–‡æ¡£åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š
```
Study every day, good good up, to forever # æ–‡æ¡£ä¸€
To forever, study every day, good good up # æ–‡æ¡£äºŒ
```
ä¸ºäº†åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œæˆ‘ä»¬è¦å°†æ¯ä¸ªæ–‡æ¡£æ‹†åˆ†æˆç‹¬ç«‹çš„è¯ï¼ˆè¯æ¡ï¼‰ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¸é‡å¤è¯æ¡çš„æ’åºåˆ—è¡¨ï¼Œç„¶ååˆ—å‡ºæ¯ä¸ªè¯æ¡å‡ºç°åœ¨å“ªä¸ªæ–‡æ¡£
![](https://fe.che300.com/easymock/upload/2020/10/29/f0ac64cdd62992dbd96eb24d143f86c8.png)

ç°åœ¨æˆ‘ä»¬è¦å»æœç´¢ to forever åªéœ€è¦æŸ¥çœ‹åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£

![](https://fe.che300.com/easymock/upload/2020/09/22/e367bf9220d4091f448394347b9c8b4f.png)

è¿™é‡Œäº§ç”Ÿäº†æƒé‡ï¼

æ€»ç»“ï¼šå€’æ’ç´¢å¼•å¸®æˆ‘ä»¬å®Œå…¨è¿‡æ»¤æ‰äº†ä¸€äº›æ— ç”¨çš„æ•°æ®ï¼Œå¸®æˆ‘ä»¬æé«˜äº†æ•ˆç‡

1ã€ç´¢å¼•ï¼ˆæ•°æ®åº“ï¼‰
2ã€å­—æ®µç±»å‹ï¼ˆmappingï¼‰
3ã€æ–‡æ¡£
4ã€åˆ†ç‰‡ï¼ˆäº†è§£ï¼ŒLuceneç´¢å¼•ï¼‰

### åˆ†è¯æ’ä»¶ï¼ˆIKåˆ†è¯å™¨ï¼‰
åˆ†è¯å°±æ˜¯æŠŠä¸€æ®µä¸­æ–‡æˆ–è€…è‹±æ–‡åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªå…³é”®å­—ï¼Œæˆ‘ä»¬åœ¨æœç´¢çš„æ—¶å€™ä¼šæŠŠè‡ªå·±çš„ä¿¡æ¯è¿›è¡Œåˆ†è¯ï¼Œä¼šæŠŠæ•°æ®åº“ä¸­çš„æˆ–è€…ç´¢å¼•åº“ä¸­çš„æ•°æ®è¿›è¡Œåˆ†è¯ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªåŒ¹é…æ“ä½œåšï¼Œé»˜è®¤çš„ä¸­æ–‡åˆ†è¯æ˜¯å°†æ¯ä¸€ä¸ªå­—çœ‹æˆä¸€ä¸ªè¯ï¼Œæ¯”å¦‚â€œæˆ‘çˆ±è‚²ä»ªâ€ä¼šè¢«åˆ†æˆâ€œæˆ‘â€â€œçˆ±â€â€œè‚²â€â€œä»ªâ€ï¼Œè¿™é‡Œæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ä¸­æ–‡çš„åˆ†è¯å™¨ã€‚
IKæä¾›äº†ä¸¤ä¸ªåˆ†è¯ç®—æ³•ï¼š`ik_smart` å’Œ `ik_max_word`ï¼Œå…¶ä¸­ `ik_smart`æ˜¯æœ€å°‘åˆ‡åˆ†ï¼Œ`ik_max_word`æ˜¯æœ€ç»†ç²’åº¦åˆ’åˆ†ï¼

é™„ä»¶ä¸­æœ‰IKåˆ†è¯å™¨çš„å®‰è£…åŒ…
1ã€å®‰è£…
2ã€ç›´æ¥è§£å‹åˆ°eså®‰è£…ç›®å½•çš„`plugin`ç›®å½•ä¸­å‘½åä¸º`ik`
3ã€é‡å¯`es`

éªŒè¯ åˆ†è¯å™¨æ˜¯å¦å®‰è£…å®Œæˆï¼Œ
4ã€ä½¿ç”¨ `elasticsearch-plugin`
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/57342a182daf43b4b0e1f844cfc6dbd0~tplv-k3u1fbpfcp-zoom-1.image)

5ã€ç”¨kibanaæµ‹è¯•ï¼

>ik_smart æœ€å°‘åˆ’åˆ†
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed60101a16d74562a72ce0828138de84~tplv-k3u1fbpfcp-zoom-1.image)
![](https://fe.che300.com/easymock/upload/2020/09/22/7850f03993d8beae7787d60cd4d168b1.png)
![](https://fe.che300.com/easymock/upload/2020/09/22/47633a0138cecfb103ad32dacc8d464a.png)

>ik_max_word æœ€å¤šåˆ’åˆ†
![](https://fe.che300.com/easymock/upload/2020/09/22/6a8f851fe3f31a9ad72635a0d61671c8.png)
![](https://fe.che300.com/easymock/upload/2020/09/22/66e266cf3796b2f3631b87629ba7197f.png)

ä¸¤ç§åˆ†è¯å™¨ä½¿ç”¨çš„æœ€ä½³å®è·µæ˜¯ï¼šç´¢å¼•æ—¶ç”¨ik_max_wordï¼Œåœ¨æœç´¢æ—¶ç”¨ik_smartã€‚
å³ï¼šç´¢å¼•æ—¶æœ€å¤§åŒ–çš„å°†æ–‡ç« å†…å®¹åˆ†è¯ï¼Œæœç´¢æ—¶æ›´ç²¾ç¡®çš„æœç´¢åˆ°æƒ³è¦çš„ç»“æœã€‚

1ã€ik_max_word

ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚â€æ‹†åˆ†ä¸ºâ€œä¸­åäººæ°‘å…±å’Œå›½ã€ä¸­åäººæ°‘ã€ä¸­åã€åäººã€äººæ°‘å…±å’Œå›½ã€äººæ°‘ã€å…±å’Œå›½ã€å¤§ä¼šå ‚ã€å¤§ä¼šã€ä¼šå ‚ç­‰è¯è¯­ã€‚

2ã€ik_smart
ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚â€æ‹†åˆ†ä¸ºä¸­åäººæ°‘å…±å’Œå›½ã€äººæ°‘å¤§ä¼šå ‚ã€‚

#### å‘ç°é—®é¢˜
![](https://fe.che300.com/easymock/upload/2020/09/22/62aa35d79509b67763285e5e8e94364d.png)
![](https://fe.che300.com/easymock/upload/2020/09/22/bc4561666926bd2ce4f4dfee95bb68d8.png)

è¿™ç§è‡ªå·±éœ€è¦çš„è¯ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±åŠ ä¸Šæˆ‘ä»¬çš„åˆ†è¯å™¨ä¸­ï¼Œæ‰ä¼šå®ç°çœŸæ­£çš„åˆ†è¯

#### è‡ªå·±æ·»åŠ è¯å…¸
`D:\tools\elasticsearch-7.9.1\plugins\ik\config\IKAnalyzer.cfg.xml`ï¼ˆè¿™æ˜¯æˆ‘çš„è·¯å¾„ï¼Œåˆ«äººå’Œæˆ‘ä¸ä¸€æ ·çš„ï¼‰
åœ¨è¿™ä¸ªç›®å½•ä¸‹ä¿®æ”¹

```tablePic
|  ![](https://fe.che300.com/easymock/upload/2020/09/22/94b72e0a58ac77eec8dc4ae38da4b2e2.png)
|_
```
åœ¨`elasticsearch-7.9.1\plugins\ik\config` ç›®å½•ä¸‹æ–°å»º è‡ªå®šä¹‰çš„è¯å…¸ä¾‹å¦‚ï¼š
1ã€æ–°å»º`yuyi.dic`
2ã€åœ¨ è¯¥æ–‡ä»¶ä¸­å†™å…¥
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0eccda86fbd04d78a0b24ac25950dedd~tplv-k3u1fbpfcp-zoom-1.image)
3ã€åœ¨ä¸‹å›¾ä½ç½®åŠ ä¸Šè‡ªå·±çš„é…ç½®æ–‡ä»¶å
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f33d9b0431045ba82a27ec34ec441e6~tplv-k3u1fbpfcp-zoom-1.image)
4ã€é‡å¯es
5ã€å†æ¬¡æµ‹è¯•
```
GET _analyze
{
  "analyzer": "ik_smart",
  "text": "è¶…çº§å–œæ¬¢è‚²ä»ªè®²"
}
```
è¿”å›å€¼å‘ç”Ÿäº†å˜åŒ–
```
{
  "tokens" : [
    {
      "token" : "è¶…çº§",
      "start_offset" : 0,
      "end_offset" : 2,
      "type" : "CN_WORD",
      "position" : 0
    },
    {
      "token" : "å–œæ¬¢",
      "start_offset" : 2,
      "end_offset" : 4,
      "type" : "CN_WORD",
      "position" : 1
    },
    {
      "token" : "è‚²ä»ª",
      "start_offset" : 4,
      "end_offset" : 6,
      "type" : "CN_WORD",
      "position" : 2
    },
    {
      "token" : "è®²",
      "start_offset" : 6,
      "end_offset" : 7,
      "type" : "CN_CHAR",
      "position" : 3
    }
  ]
}
```
ä»¥åéœ€è¦è‡ªå·±é…ç½®ï¼Œå°±éœ€è¦è‡ªå·±åœ¨åˆ†è¯ä¸­è®¾ç½®å³å¯

### Rest é£æ ¼è¯´æ˜
è¿™æ˜¯ä¸€ç§æ¶æ„é£æ ¼è€Œä¸æ˜¯æ ‡å‡†ï¼Œä»–ç”¨äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨äº¤äº’ ç±»çš„è½¯ä»¶ï¼ŒåŸºäºè¿™ä¸ªé£æ ¼è®¾è®¡è½¯ä»¶å¯ä»¥æ›´ç®€æ´ã€æ›´æœ‰å±‚æ¬¡ç­‰ã€‚


| method | urlåœ°å€ | æè¿° |
| --- | --- | --- |
| PUT | localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id | åˆ›å»ºæ–‡æ¡£ï¼ˆæŒ‡å®šæ–‡æ¡£idï¼‰ |
| POST | localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§° | åˆ›å»ºæ–‡æ¡£ï¼ˆéšæœºæ–‡æ¡£idï¼‰ |
| POST | localhost:9200/ç´¢å¼•åç§°/_update/æ–‡æ¡£id  | ä¿®æ”¹æ–‡æ¡£ |
| DELETE | localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id | åˆ é™¤æ–‡æ¡£ |
| GET | localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id | é€šè¿‡æ–‡æ¡£idæŸ¥è¯¢æ–‡æ¡£ |
| POST | localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/_search | æŸ¥è¯¢æ‰€æœ‰æ•°æ® |


#### åˆ›å»ºæ–‡æ¡£ 
##### ç¤ºä¾‹1
```js
PUT /test1/type1/1
{
  "name":"è‚²ä»ª",
  "age":24
}
```
ç±»å‹åæœªæ¥åœ¨ 8ç‰ˆæœ¬ä¸­ä¼šè¢«åˆ é™¤
![](https://fe.che300.com/easymock/upload/2020/09/22/a6e7b806699a88d9a1b5e10e698e8bf6.png)
![](https://fe.che300.com/easymock/upload/2020/09/22/a87e54c98a5ec7d2cde0d26ebc9250c6.png)
##### ç¤ºä¾‹2
```js
PUT /test3/_doc/1
{
  "name":"è‚²ä»ªåˆ†äº«ä¼š",
  "age":24,
  "birth":"1996-09-12"
}
```
<mark>è¿™é‡Œçš„_docæ˜¯æœªæ¥eså®˜æ–¹æŒ‡å®šçš„ç±»å‹ï¼Œæœªæ¥å°†å»æ‰ç±»å‹åç§°ï¼Œç»Ÿä¸€ä¸ºä¸€ä¸ªç³»ç»ŸæŒ‡å®šçš„_doc</mark>

å¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®š æ–‡æ¡£ç±»å‹ï¼Œesé»˜è®¤ä¼šå¸®æˆ‘ä»¬æŒ‡å®šç±»å‹

![](https://fe.che300.com/easymock/upload/2020/09/23/5020b6707a3472be543935d1b562d608.png)

#### å­—æ®µæŒ‡å®šç±»å‹
* å­—ç¬¦ä¸²ç±»å‹ï¼štextã€keyword
* æ•°å€¼ç±»å‹ï¼šlongã€integerã€shortã€byteã€doubleã€floatã€half floatã€scaled float
* æ—¥æœŸç±»å‹ï¼šdate
* teå¸ƒå°”ç±»å‹ï¼šboolean
* äºŒè¿›åˆ¶ç±»å‹ï¼šbinary
* ç­‰ç­‰......

æµ‹è¯•
```js
PUT /test2
{
  "mappings": {
    "properties": {
      "name":{
        "type": "text"
      },
      "age":{
        "type": "long"
      },
      "birthday":{
        "type": "date"
      }
    }
  }
}
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23726b64adb24a5daf1e10977149fd9e~tplv-k3u1fbpfcp-zoom-1.image)
è¿”å›ä¸Šå›¾åˆ™æˆåŠŸ

mappingsã€propertiesä¸ºæŒ‡å®šå­—æ®µç±»å‹çš„å¿…é¡»æ ¼å¼ï¼Œå†…éƒ¨çš„nameã€ageã€birthdayä¸ºç”¨æˆ·æƒ³è¦çš„ç±»å‹ï¼Œç±»ä¼¼mysqlçš„å»ºè¡¨ã€‚ 

#### é€šè¿‡getè¯·æ±‚è·å–ä¿¡æ¯
```js
GET /test2
```
å¯ä»¥é€šè¿‡getè¯·æ±‚ï¼Œç›´æ¥è·å–test2ç´¢å¼•çš„å…¨éƒ¨ä¿¡æ¯

![](https://fe.che300.com/easymock/upload/2020/09/23/999729c77f76915d202e092b98014990.png)

#### æ‹“å±•ï¼šé€šè¿‡å‘½ä»¤ æŸ¥çœ‹ es ç´¢å¼•æƒ…å†µ
> æŸ¥çœ‹æ•°æ®åº“å¥åº·å€¼
```js
GET _cat/health
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7cc0eb2c60354002b9bf5598d2d485c0~tplv-k3u1fbpfcp-zoom-1.image)

>æŸ¥çœ‹eså¾ˆå¤šä¿¡æ¯
```js
GET _cat/indices?v
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c706af53fe3c421d86485d2a2aef3f7c~tplv-k3u1fbpfcp-zoom-1.image)

ç­‰ç­‰è¿˜æœ‰å¾ˆå¤š

#### ä¿®æ”¹

> ä¿®æ”¹æäº¤è¿˜æ˜¯ä½¿ç”¨PUT ç„¶åè¦†ç›–å³å¯ï¼(<mark>æ›¾ç»çš„æ–¹æ³•</mark>)
```js
PUT /test3/_doc/1
{
  "name":"è‚²ä»ªåˆ†äº«ä¼š20200921",
  "age":24,
  "birth":"1996-09-12"
}
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9d8aba0d70e486f883f6971ebf20d11~tplv-k3u1fbpfcp-zoom-1.image)
è¿™ç§ä¿®æ”¹æ›´æ–°æ–¹å¼æ˜¯æ•´ä½“ä¿®æ”¹ï¼Œä¸€æ—¦ä¸¢æ‰æ•°æ®åˆ™ä¼šäº§ç”Ÿä¿®æ”¹é”™è¯¯çš„å­—æ®µ


> æ›´æ–°çš„æ–¹æ³•ï¼ˆæ–°çš„ï¼‰
```js
POST /test3/_update/1
{
  "doc":{
    "name":"è‚²ä»ªå¤§é­”ç‹"
  }
}
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/757296de5dfc4ecbaac6e28de4246e50~tplv-k3u1fbpfcp-zoom-1.image)
æ›´æ–°æˆåŠŸï¼Œå†è°ƒç”¨æŸ¥çœ‹æ–¹æ³•å³å¯å‘ç°å°±`name`å­—æ®µå‘ç”Ÿäº†å˜åŒ–ã€‚
å€¼å¾—æ³¨æ„çš„æ˜¯ `doc`æ˜¯å›ºå®šå†™æ³•

#### åˆ é™¤
> åˆ é™¤æ•´ä¸ªç´¢å¼•
```js
DELETE /test1
```
è¿”å›å€¼ï¼š![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e83fb1fa4da47cabc1bbe791a6285ba~tplv-k3u1fbpfcp-zoom-1.image)

> åˆ é™¤ä¸€æ¡æ•°æ®
```js
Delete /test3/_doc/1
```
ä½¿ç”¨RESTFULé£æ ¼æ˜¯æˆ‘ä»¬ESæ¨èå¤§å®¶ä½¿ç”¨çš„ï¼

### å…³äºæ–‡æ¡£çš„æ“ä½œ
#### åŸºæœ¬æ“ä½œ
1ã€å…ˆåˆ›å»ºä¸€ä¸ªç´¢å¼•å¹¶åŠ å…¥æ•°æ®
```js
PUT /yuyi/_doc/1
{
  "name":"æœ±è‚²ä»ª",
  "age":24,
  "desc":"æˆ‘æ˜å¤©å°±è¦åˆ†äº«äº†ï¼Œæˆ‘æ…Œçš„ä¸€æ‰¹",
  "tags":["æŠ€æœ¯å®…","æ¸©æš–","ç›´ç”·"]
}

PUT /yuyi/_doc/2
{
  "name":"å¼ ä¸‰",
  "age":24,
  "desc":"æˆ‘æ˜¯å¼ ä¸‰",
  "tags":["å‚»å‰","æ—…æ¸¸","æ¸£ç”·"]
}

PUT /yuyi/_doc/3
{
  "name":"æå››",
  "age":30,
  "desc":"æˆ‘æ˜¯æå››",
  "tags":["é“å¥³","æ—…æ¸¸","å”±æ­Œ"]
}
```


2ã€æŸ¥è¯¢
æŸ¥è¯¢yuyiç´¢å¼•ä¸‹çš„  1å·äººç‰©
```js
GET /yuyi/_doc/1
```

3ã€æœç´¢
æ¡ä»¶æŸ¥è¯¢
è·å–ä¸€å·ç”¨æˆ·çš„
```js
GET /yuyi/_doc/_search?q=name:æœ±è‚²ä»ª
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae4a9c6eee5a451c956b283779f00801~tplv-k3u1fbpfcp-zoom-1.image)

æˆ‘ä»¬å‘ç° ä¸Šå›¾ä¸­æœ‰ä¸€ä¸ª _scoreè¿™ä¸ªå­—æ®µï¼Œå¦‚æœæœ‰å¤šæ¡æ•°æ®ï¼ŒåŒ¹é…åº¦è¶Šé«˜åˆ™åˆ†å€¼è¶Šé«˜


ç•¥å¤æ‚çš„æŸ¥è¯¢æ–¹å¼
```js
GET /yuyi/_doc/_search
{
  "query":{
    "match":{
      "name":"æœ±è‚²ä»ª"
    }
  }
}
```
è¿˜æ˜¯ä¸€æ ·è¿”å›ä¸Šæ–‡å›¾ç‰‡çš„è¿”å›å€¼

#### é€šè¿‡ _source æŒ‡å®šè¿”å›å€¼
```js
GET /yuyi/_doc/_search
{
  "query":{
    "match":{
      "name":"æœ±è‚²ä»ª"
    }
  },
  "_source":["name","age"]
}
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/662594e43b6445fea43e236e1000874a~tplv-k3u1fbpfcp-zoom-1.image)![]

æˆ‘ä»¬ä¹‹åä½¿ç”¨nodejs æ“ä½œesï¼Œæ‰€æœ‰çš„æ–¹æ³•å’Œå¯¹è±¡å°±æ˜¯è¿™é‡Œé¢çš„keyï¼

#### æ’åº
```js
GET /yuyi/_doc/_search
{
  "query":{
    "match_all":{}
  },
  "sort":[
    {
      "age":{
        "order":"desc"
      }
    }
  ]
}
```
`match_all`ä»£è¡¨å…¨æ–‡åŒ¹é…  `sort` å­—æ®µæ˜¯ä¸ªæ•°ç»„é‡Œé¢ä¼ é€’å¯¹è±¡ç”¨æ¥æ’åºï¼Œä¸Šé¢çš„è¯­å¥æ˜¯å¯¹`age`è¿›è¡Œæ’åºï¼Œ`order`ä»£è¡¨æ’åºè§„åˆ™â€œ`desc`é™åº `asc`å‡åºâ€
æœ‰äº†å›ºå®šçš„æ’åºåï¼Œ`_score`åˆ†å€¼å°±æ²¡äº†ã€‚

#### åˆ†é¡µ
```js
GET /yuyi/_doc/_search
{
  "query":{
    "match_all":{
    }
  },
  "sort":[
    {
      "age":{
        "order":"desc"
      }
    }
  ],
  "from":0,
  "size":2
}
```
`from`ä»£è¡¨äº†ä»ç¬¬å‡ ä¸ªå¼€å§‹ï¼Œ`size`è¡¨ç¤ºæ¯é¡µå¤šå°‘ä¸ª

#### å¸ƒå°”å€¼æŸ¥è¯¢
```js
GET /yuyi/_doc/_search
{
  "query":{
    "bool":{
      "must":[
        {
          "match":{
            "name":"è‚²ä»ª"
          }
        },
        {
          "match":{
            "age":24
          }
        }
      ]
    }
  }
}
```
é‡‡ç”¨ boolå­—æ®µï¼Œ å†…éƒ¨å¯é€‰å‚æ•°ï¼šmustï¼ˆå¿…é¡»åŒ…å«ï¼‰must_notï¼ˆå¿…é¡»ä¸åŒ…å«ï¼‰shouldï¼ˆæœ‰ä¸€ä¸ªå°±å¯ä»¥äº†ï¼‰ï¼ˆminimum_should_match: ç”¨æ¥æ§åˆ¶è‡³å°‘åŒ¹é…å¤šå°‘ä¸ªshouldåŒ¹é…çš„ï¼‰
ä¸Šé¢åŒ¹é…çš„æ˜¯ `name`åŒ…å« `è‚²ä»ª`å­—æ®µ `age` æ˜¯ `24`çš„æ•°æ®
![](https://fe.che300.com/easymock/upload/2020/09/23/7cbffaea6243cd05f550be53222f6115.png)

shouldæŸ¥è¯¢æµ‹è¯•
```
GET /yuyi/_doc/_search
{
  "query":{
    "bool":{
      "should":[
        {
          "match":{
            "name":"è‚²ä»ª"
          }
        },
        {
          "match":{
            "age":24
          }
        }
      ]
    }
  },
  "from":0,
  "size":2
}
```
ä¼šè¿”å›åªè¦ç¬¦åˆname æ˜¯è‚²ä»ª æˆ–è€… ageæ˜¯ 24çš„å°±å¯ä»¥äº†ã€‚

![](https://fe.che300.com/easymock/upload/2020/09/23/7fa52b183a130a332d41d621a98566b2.png)
#### è¿‡æ»¤æŸ¥è¯¢
```js
GET /yuyi/_doc/_search
{
  "query":{
    "bool":{
      "must":[
        {
          "match":{
            "name":"è‚²ä»ª"
          }
        }
      ],
      "filter":{
        "range":{
          "age":{
            "gte":10,
            "lte":30
          }
        }
      }
    }
  }
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/e5455756cab135251d85eda6ba1e8db0.png)

é€šè¿‡ `filter`æŸ¥è¯¢è¿‡æ»¤æ•°æ®ï¼Œå°†è¿‡æ»¤`age`å¤§äºç­‰äº10å°äºç­‰äº30çš„
`gt`å¤§äº `lt`å°äº  `gte`å¤§äºç­‰äº   `lte`å°äºç­‰äº

#### æ•°ç»„ç±»å‹ä¹Ÿå¯ä»¥åŒ¹é…
```js
GET /yuyi/_doc/_search
{
  "query":{
    "match":{
      "tags":"ç”·"
    }
  }
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/dcf4e337f1bcf845e807d987cf1560d6.png)

æƒ³è¦åŒ¹é…å¤šä¸ªæ¡ä»¶ç›´æ¥ç©ºæ ¼éš”å¼€å³å¯
```js
GET /yuyi/_doc/_search
{
  "query":{
    "match":{
      "tags":"ç”· æŠ€æœ¯"
    }
  }
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/00cbeb26f978ae58f64dd774fcc62cd4.png)

æˆ‘ä»¬å‘ç°åªè¦åŒ¹é…åˆ°äº†è¿™ä¸¤ä¸ªè¯ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œå°±ä¼šè¢«è¿”å›ï¼Œç„¶è€Œç¬¬äºŒæ¡æ•°æ®å¹¶ä¸å¤ªç¬¦åˆ`æŠ€æœ¯`è¿™ä¸ªå…³é”®è¯ã€‚
è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡è¿”å›å€¼ä¸­çš„åˆ†å€¼è¿›è¡ŒåŸºæœ¬çš„åˆ¤æ–­ï¼ŒåŒ¹é…ç¨‹åº¦ã€‚

#### ç²¾ç¡®æŸ¥è¯¢

term ç›´æ¥é€šè¿‡å€’æ’ç´¢å¼•ç²¾ç¡®æŸ¥æ‰¾çš„

å…³äºåˆ†è¯ï¼Œtermä¼šç›´æ¥æŸ¥è¯¢ç²¾ç¡®å€¼ï¼Œmatchä¼šä½¿ç”¨åˆ†è¯å™¨è§£æï¼Œå†é€šè¿‡åˆ†æçš„æ–‡æ¡£æŸ¥è¯¢

**ä¸¤ä¸ªç±»å‹ text keyword**
textç±»å‹ä¼šè¢«åˆ†è¯å™¨è¿›è¡Œè§£æ
keywordä¸ä¼šè¢«åˆ†å‰²è§£æ

æµ‹è¯•ä»£ç ä¸€ä¸ªä¸€ä¸ªè¯·æ±‚
```js
PUT testdb
{
  "mappings": {
    "properties": {
      "name":{
        "type": "text"
      },
      "desc":{
        "type": "keyword"
      }
    }
  }
}

PUT testdb/_doc/1
{
  "name":"è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š",
  "desc":"è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š"
}

PUT testdb/_doc/2
{
  "name":"è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š name",
  "desc":"è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š desc"
}
```
æŸ¥çœ‹åˆ†è¯ç»“æœ
```
GET _analyze
{
  "analyzer": "keyword",
  "text":"è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š"
}
```
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3779f8a1f8a48fd8787f3fa41a7f423~tplv-k3u1fbpfcp-zoom-1.image)
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œkeywordå½¢å¼å°†ä¸å†è¿›è¡Œåˆ†è¯

```
GET _analyze
{
  "analyzer": "ik_smart",
  "text":"è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š"
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/5069c6480790c38c98227833cd03dfdc.png)


ä½¿ç”¨ikåˆ†è¯å™¨åæ˜¯è¿™ä¸ªç»“æœ

> ç²¾å‡†æŸ¥è¯¢çš„æµ‹è¯•
```js
GET /testdb/_search
{
  "query":{
    "term":{
      "name":"è‚²"
    }
  }
}
```
æŸ¥è¯¢`name`ä¸­å«æœ‰`è‚²`çš„æ•°æ®ï¼Œç”±äºnameå±æ€§æ˜¯textç±»å‹ï¼Œä¼šè¢«åˆ†è¯

![](https://fe.che300.com/easymock/upload/2020/09/23/151d726bd2ae28a57d1b91755c47ea7f.png)


```js
GET /testdb/_search
{
  "query":{
    "term":{
      "desc":"è‚²"
    }
  }
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/e08c83d3ad3ec6aff881ea1af75d3184.png)

æ­¤æ—¶æˆ‘ä»¬å‘ç° `desc`æŸ¥è¯¢`è‚²`å­—æ—¶æ— å€¼ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨äº†`keyword`ç±»å‹ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨`è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š` å…¨éƒ¨æ–‡å­—æ‰èƒ½åŒ¹é…åˆ°å€¼ã€‚å¦‚ä¸‹æ–¹çš„æµ‹è¯•
```js
GET /testdb/_search
{
  "query":{
    "term":{
      "desc":"è‚²ä»ªå‡†å¤‡åˆ†äº«ä¼š"
    }
  }
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/bee469ed206e1700d2af2c769e16aa2a.png)

æ€»ç»“ï¼š`keyword`ä¸ä¼šè¢«åˆ†è¯å™¨è§£æ

#### å¤šä¸ªå€¼åŒ¹é…çš„ç²¾ç¡®æŸ¥è¯¢
æµ‹è¯•ä»£ç ï¼ˆæ’å…¥å¤šä¸ªæ•°æ®ï¼‰
```js
PUT testdb/_doc/3
{
  "t1":"22",
  "t2":"2020-09-23"
}
PUT testdb/_doc/4
{
  "t1":"33",
  "t2":"2020-09-24"
}
```
ä½¿ç”¨ `term`ç²¾ç¡®æŸ¥è¯¢å¤šä¸ªå€¼
```js
GET /testdb/_search
{
  "query":{
    "bool":{
      "should": [
        {
          "term":{
            "t1":"22"
          }
        },
        {
          "term":{
            "t1":"33"
          }
        }
      ]
    }
  }
}
```
![](https://fe.che300.com/easymock/upload/2020/09/23/8f25799a863ce35eec244bed1edceb18.png)

#### é«˜äº®æŸ¥è¯¢
```js
GET /yuyi/_search
{
  "query":{
    "match":{
      "name":"è‚²ä»ª"
    }
  },
  "highlight": {
    "fields": {
      "name": {}
    }
  }
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/50cc7b8d36714e23850a7163d0c21b69.png)

é€šè¿‡ ä¸Šæ–‡æ–¹å¼å¯ä»¥å®ç°é«˜äº®ï¼Œ`highlight``fields`ä¸ºå›ºå®šå†™æ³•

æˆ‘ä»¬è¿™é‡Œä¸æƒ³ç”¨`em`æ ‡ç­¾
æƒ³ç”¨å…¶ä»–çš„
```js
GET /yuyi/_search
{
  "query":{
    "match":{
      "name":"è‚²ä»ª"
    }
  },
  "highlight": {
    "pre_tags": "<p class='myClassName' style='color:red'>", 
    "post_tags": "</p>", 
    "fields": {
      "name": {}
    }
  }
}
```

![](https://fe.che300.com/easymock/upload/2020/09/23/57872b1a2fbc8468b4029340ae1a2060.png)
è¿™é‡Œä½¿ç”¨ `pre_tags` `post_tags` æ¥è‡ªå®šä¹‰æ ‡ç­¾é«˜äº®


### å‚è€ƒæ–‡æ¡£ï¼š
[Elasticsearch é›†ç¾¤åˆ†é…å¤šå°‘åˆ†ç‰‡åˆç†](https://www.jianshu.com/p/297e13045605)
[RESTful APIæ¥å£è®¾è®¡æ ‡å‡†åŠè§„èŒƒ](https://blog.csdn.net/qq_41606973/article/details/86352787)
[Elasticsearchçš„åœç”¨è¯](cnblogs.com/zlslch/p/6440220.html)
[Elasticsearch ä¹‹ï¼ˆ24ï¼‰IKåˆ†è¯å™¨é…ç½®æ–‡ä»¶è®²è§£ä»¥åŠè‡ªå®šä¹‰è¯åº“](https://blog.csdn.net/wuzhiwei549/article/details/80451031)
[ElasticSearch 9200å’Œ9300ç«¯å£çš„ä½œç”¨](https://blog.csdn.net/weixin_44829930/article/details/108806059)
[ä¸ºä»€ä¹ˆç°åœ¨è¦ç§»é™¤typeï¼Ÿ](https://www.cnblogs.com/huangfox/p/9460361.html)
[Elasticsearch å…¥é—¨å­¦ä¹ ](https://juejin.cn/post/6844904053709733896#heading-0)
[ik_max_wordå’Œ ik_smartä»‹ç»](https://www.cnblogs.com/zeenzhou/p/13432349.html)
è¿˜æœ‰å¾ˆå¤šå€Ÿé‰´å…¶ä»–çš„å‡ºå¤„å¿˜è®°äº†ã€‚ã€‚ã€‚





